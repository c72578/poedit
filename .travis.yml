sudo: required
dist: trusty

language: cpp

compiler: gcc

# dependencies for building Poedit on old Ubuntu:
addons:
    apt:
        sources:
            - ubuntu-toolchain-r-test
            - sourceline: 'ppa:vslavik/poedit'
        packages:
            - gcc-6
            - g++-6
            - asciidoc
            - xsltproc
            - xmlto
            - libexpat1-dev
            - libdb++-dev
            - libboost-dev
            - libboost-system-dev
            - libboost-regex-dev
            - libboost-thread-dev
            - libboost-iostreams-dev
            - liblucene++-dev
            - libicu-dev
            - libwxgtk3.0-dev
            - libgtk2.0-dev
            - libgtkspell-dev
            - libcld2-dev
            - libcpprest-dev
            - libsecret-1-dev

env:
    - REAL_CC='ccache gcc-6' REAL_CXX='ccache g++-6'

before_install:
    # work around Travis being difficult, see https://github.com/travis-ci/travis-ci/issues/6633
    - export CC="$REAL_CC" CXX="$REAL_CXX"
    # git submodules needed for Linux:
    - git submodule update --init deps/json deps/pugixml

script:
    - scripts/travis-check-translations.sh
    # don't build directly, create a tarball first and try building from that
    - ./bootstrap && ./configure && make dist && make distcheck

after_failure:
    - test -f Makefile || cat config.log

git:
    submodules: false

cache:
    apt: true
    ccache: true

deploy:
    provider: releases
    api_key:
        secure: t8iW5Wt4W1pwGdEFRFZNq7FVB4pP4oaRp7dZ2Pe6eluCynVQg60E+nHHtnXTU3sadn6p+stQJ7kXk2PggVM0dY1BNHTPdYiicrPZE6zpww5Fzpb7NLdXp7XiAqM5z1Ix+Aloj7Kf0W8SiDfM/ceMa+FjccXpA2t+gv4EjojcyqXetz+BSSoNq4HxU3gkXyK8WcKEyiJHwZjmUzJi+RTJYPcy/bF0+61YjbawUBE5Gm6loZlTqCMS3OXAhw/9PAF7t0As4WRC7N86Au2tJ9xVTpKef9SubEA3epzsMd5mKiXEzWpbqPlqt6qqX8E8zolf574Rz5mXtlOazw3A0HqB+dcVcdHJu7WsQFAiBGzFOY9f5wpmH49EZTk6X8K/4W4wDGpPoGhgH6h8/15p6dtYO8LESk+Pw/ienrKSco/39f93fVkwkcl1/Ok1xctBH/3KVTeyZfJLbmUPvdy48/UKieyB9mIvYABatwxlrW7lXMyi9//Dm/bftj4bw98PLpAOeEW4jBVbWRqv5LcaMrzNJHdwLLeqTlw9BLocw2a8W+UvoY166P1u8IicQwuNK6Bmt2DaP9BgnOr68HMqecI697rn0xaDerXlDkNLkuIWJK9g/THThn8K5BVsyCVIdjwKZmd5DeIZ0RT04llnndBChdigRp+u5wcvXaROoXThdec=
    skip_cleanup: true
    file: poedit-2.1.tar.gz
    on:
        repo: c72578/poedit
        branch: master_fork_travis
